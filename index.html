<!DOCTYPE html>
<html>

<head>
    <title>Github Profile Display</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>

<body>
    
    <div class="container">
        <header>
            <h1>Github Profile Viewer</h1>
            <form id="handleForm">
                <div class="mb-3">
                    <label for="name" class="form-label">Handle</label>
                    <input type="name" class="form-control" id="handle" aria-describedby="handleHelp">
                </div>
                <button type="submit" class="btn btn-primary">Submit</button><br><br>
                <div class="alert d-none" id="alertmsg"></div>
            </form>
            <hr><br>
        </header>

        <div class='card' style="width: 300px;" id='profile'>
            <div class="card-img-top" id="profile-image" alt="Github Profile Image"></div>
            <div class="card-body">
                <h4 class='card-title' id="name"></h4>
                <span id="company"></span><br>
                <span id="location"></span><br>
                <span id="site"></span><br>
            </div>
        </div>
    </div>
    
    <script>
        /* Checks submitted handle on Github API, returns profile details as object
         * hndl: string of github username
         * Returns: JSON parsed object from Github API
         */
        function getProfile(hndl) {
            var username = hndl;
            
            var xhttp = new XMLHttpRequest();
            
            xhttp.onreadystatechange = function() {
                if (xhttp.readyState == 4 && xhttp.status == 200) {
                    var user = JSON.parse(xhttp.responseText);
                    document.getElementById('profile-image').innerHTML = "<img class='card-img-top' src='" + user.avatar_url + "'>";
                    document.getElementById('name').innerHTML = "<h3>" + user.name + "</h3>";
                    document.getElementById('company').innerHTML = "<i class=\"bi bi-briefcase\"></i> " + user.company;
                    document.getElementById('location').innerHTML = "<i class=\"bi bi-geo-alt\"></i> " + user.location;
                    document.getElementById('site').innerHTML = "<i class=\"bi bi-cloud\"></i> " + "<a href='"+user.blog+"'>" + user.blog + "</a>";
                }
            }
            
            xhttp.open('GET', 'https://api.github.com/users/' + username, true);
            xhttp.send();
        }
        
        /* Checks if white space is contained in a given string
         * s: string to be checked
         * Returns: bool
         */
        function hasWhiteSpace(s) {
          return s.indexOf(' ') >= 0;
        }

        
        function checkProfile(e) {
            e.preventDefault();
            //console.log("Submitted...");
            
            var handle = document.getElementById('handle').value;
            var msg = document.getElementById('alertmsg');
            
            //check if handle is empty
            if (handle == ''){
                msg.innerHTML = 'Please fill in a handle.';
                msg.className = "alert alert-danger";
            } else {
                
                //check name is > 1 characters
                if (handle.length <= 2) {
                    msg.innerHTML = 'The handle can\'t be that short, nice try...';
                    msg.className = "alert alert-warning";
                    
                } else {
                    
                    //check handle for whitespace
                    if (hasWhiteSpace(handle)) {
                        msg.innerHTML = 'No spaces allowed, try removing them.';
                        msg.className = "alert alert-warning";
                        
                    } else {
                        //success
                        msg.className = "d-none"; //hide alert box
                        getProfile(handle);
                    }
                    
                }
                
            }
            
        }
        
        document.getElementById('handleForm').addEventListener('submit', checkProfile, false);
    </script>
    
</body>

</html>